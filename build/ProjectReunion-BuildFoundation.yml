name: $(BuildDefinitionName)_$(date:yyMM).$(date:dd)$(rev:rrr)
variables:
- template: WindowsAppSDK-Versions.yml
- template: WindowsAppSDK-CommonVariables.yml

parameters:
  - name: "ReleaseSigning"
    type: boolean
    default: False
  - name: "PublishToMaestro"
    type: boolean
    default: False
  - name: "WindowsAppRuntimeInsightsSourceDirectory"
    type: string
    default: $(Build.SourcesDirectory)\dev\WindowsAppRuntime_Insights

jobs:
# Build WinAppSDK
- job: IntegrationTest
  dependsOn: ['CreateNugetPackage']
  condition: succeeded()
  pool: $(ProjectReunionBuildPool)
  variables:
    WindowsAppSDKPackageVersion: $[ dependencies.CreateNugetPackage.outputs['SetVersion.packageVersion'] ]
  steps:
    - template: ..\eng\common\AzurePipelinesTemplates\WindowsAppSDK-Build-Steps.yml
      parameters:
        BuildType: 'stable'
        TransportPackages: 
          FoundationPackage:
            Name: Microsoft.WindowsAppSDK.Foundation.TransportPackage
            Version: 2.42
          IxpPackage:
            Name: Microsoft.ProjectReunion.InteractiveExperiences.TransportPackage
            Version: 1.23

# - ${{ if or(eq(variables['Build.Reason'], 'Schedule'), eq(parameters.publishToMaestro, 'true')) }}:
#   - template: ..\..\eng\common\AzurePipelinesTemplates\Maestro-PublishBuildToMaestro-Steps.yml
#     parameters:
#       AssetName: 'Microsoft.WindowsAppSDK.Foundation.TransportPackage'
#       AssetVersion: $(packageVersion)
#       TriggerSubscription: true